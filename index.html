<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ù…Ø¹Ù…Ù„ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --blue: #00f3ff; --purple: #bc13fe; --bg: #05070a; --green: #39ff14; --pink: #ff0055; }
        
        /* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¥Ø²Ø§Ø­Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ */
        * { box-sizing: border-box; }
        body, html { 
            height: 100%; margin: 0; padding: 0; 
            background: var(--bg); color: #fff; 
            font-family: 'Cairo', sans-serif; 
            overflow-x: hidden; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù‚Øµ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± */
            display: flex; flex-direction: column;
            width: 100%;
        }

        .space-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #1b2735 0%, #05070a 100%); }
        
        /* Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        .floating-atom { position: fixed; bottom: 20px; left: 20px; width: 80px; opacity: 0.7; animation: rotateAtom 15s linear infinite; z-index: 1; }
        @keyframes rotateAtom { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .refresh-btn { position: fixed; top: 15px; right: 15px; z-index: 2000; background: rgba(255,255,255,0.1); border: 1px solid var(--blue); color: #fff; padding: 8px 12px; border-radius: 10px; cursor: pointer; backdrop-filter: blur(5px); font-size: 14px; }
        
        .school-header { text-align: center; padding: 20px 10px; background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--blue); width: 100%; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± */
        .dashboard-bar { display: flex; justify-content: center; align-items: center; gap: 10px; padding: 10px; background: rgba(0,243,255,0.05); flex-wrap: wrap; }
        .stat-item { background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--blue); font-size: 0.85rem; display: flex; align-items: center; gap: 8px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--green); box-shadow: 0 0 10px var(--green); animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.3; } }

        .main-wrapper { flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; padding: 20px; }
        
        /* Ø¥ØµÙ„Ø§Ø­ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
        .card { 
            background: rgba(10, 15, 25, 0.8); backdrop-filter: blur(20px); 
            padding: 40px 25px; border-radius: 35px; border: 2px solid var(--blue); 
            text-align: center; width: 100%; max-width: 450px; 
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            display: flex; flex-direction: column; align-items: center; /* ÙŠØ¶Ù…Ù† Ø§Ù„ØªÙˆØ³Ø· */
        }

        /* ØªÙˆØ³ÙŠØ· Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ…Ù†Ø¹ Ø§Ù„ØªØµØ§Ù‚Ù‡Ø§ */
        .input-group { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; margin: 20px 0; }
        .input-style { 
            width: 100%; max-width: 350px; padding: 15px; 
            border-radius: 15px; border: 2px solid var(--blue); 
            background: rgba(0,0,0,0.7); color: #fff; 
            text-align: center; font-size: 1.1rem; outline: none;
        }

        .btn { background: var(--purple); color: #fff; border: none; padding: 15px 30px; border-radius: 15px; cursor: pointer; font-weight: bold; width: 100%; max-width: 350px; transition: 0.3s; font-size: 1.1rem; }
        .btn:hover { background: var(--blue); color: #000; box-shadow: 0 0 20px var(--blue); }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        #quiz-area, #tabs-container, #result-screen { display: none; }

        @media (max-width: 600px) {
            .card { padding: 30px 15px; width: 95%; margin: 0 auto; }
            .glowing-title { font-size: 1.4rem !important; }
            .floating-atom { width: 60px; bottom: 10px; left: 10px; }
        }
    </style>
</head>
<body>

<button class="refresh-btn" onclick="location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
<div class="space-bg"></div>

<img src="https://cdn-icons-png.flaticon.com/512/2554/2554936.png" class="floating-atom" alt="atom">

<div class="school-header">
    <h2 id="ui-school-name" class="glowing-title" style="margin:0; font-size: 1.6rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
    <p style="margin:10px 0;">
        <span id="ui-manager-name" style="color:var(--blue)">...</span> | 
        <span id="ui-teacher-name" style="color:var(--green)">...</span>
    </p>
</div>

<div id="dashboard" class="dashboard-bar">
    <div class="stat-item">
        <span class="status-dot"></span> <span id="status-text">Ù…ØªØµÙ„</span>
    </div>
    <div class="stat-item">
        <span>Ø§Ù„Ø²ÙˆØ§Ø±:</span> <b id="v-count" style="color:var(--blue); font-family:Orbitron;">0000</b>
    </div>
    <div class="stat-item">
        <span>Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†:</span> <b id="active-count" style="color:var(--green); font-family:Orbitron;">1</b>
    </div>
</div>

<div class="main-wrapper">
    <div id="login-screen" class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/2026/2026521.png" style="width:100px; margin-bottom:20px;" alt="Astronaut">
        <h1 class="glowing-title" style="font-size: 2.2rem; margin:0;">SCIENCE LAB</h1>
        
        <div class="input-group">
            <input type="text" id="stdName" class="input-style" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙŠØ§ Ø¨Ø·Ù„">
            <select id="stdLevel" class="input-style">
                <option value="" disabled selected>Ø§Ø®ØªØ± ØµÙÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                <option value="Ø³Ø§Ø¯Ø³ Ø£">Ø³Ø§Ø¯Ø³ Ø£</option>
                <option value="Ø³Ø§Ø¯Ø³ Ø¨">Ø³Ø§Ø¯Ø³ Ø¨</option>
                <option value="Ø§ÙˆÙ„ Ù…ØªÙˆØ³Ø·">Ø§ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option>
                <option value="Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·">Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option>
            </select>
            <button class="btn" onclick="startApp()">Ø§Ù†Ø·Ù„Ù‚ Ù„Ù„Ù…Ø®ØªØ¨Ø± ğŸš€</button>
        </div>
    </div>

    <div id="tabs-container" class="card" style="max-width: 600px;">
        <h3 id="welcome-msg" style="color: var(--blue); margin-bottom: 25px;"></h3>
        <div id="tabs" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; width:100%;"></div>
    </div>

    <div id="quiz-area" class="card">
        <div style="display:flex; justify-content: space-between; width:100%; margin-bottom: 20px;">
            <span id="timerText" style="color:var(--pink); font-family:'Orbitron'; font-weight:bold;">30s</span>
            <span id="qCounter" style="color:var(--blue); font-weight:bold;"></span>
        </div>
        <img id="questionImg" class="q-image" style="width:100%; border-radius:15px; display:none; margin-bottom:15px;">
        <h2 id="qText" style="margin-bottom:25px;"></h2>
        <div id="optionsContainer" style="width:100%;"></div>
    </div>
</div>

<script>
    const SHEET_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQoDltg5gz2B-6xfejx4s0Rm-EtYaWjwGII5P8Wk4OEh-o3dpYBy9V_2udC1SLD89tSQFFD88Pqd0Ms/pub?gid=0&single=true&output=csv';
    let allData = [];

    window.onload = () => {
        fetchData();
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙŠÙ† Ø§Ù„Ø¢Ù†
        setInterval(() => {
            document.getElementById('active-count').innerText = Math.floor(Math.random() * 4) + 1;
        }, 5000);
    };

    async function initVisitorCounter() {
        const urlId = "sci-lab-v5-main";
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù„Ù„Ø¹Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„ÙƒÙ„ Ø¯Ø®ÙˆÙ„
            const res = await fetch(`https://api.mojotv.cn/api/v1/count?id=${urlId}`);
            const data = await res.json();
            document.getElementById('v-count').innerText = (data.data || 1).toString().padStart(4, '0');
        } catch (e) {
            document.getElementById('v-count').innerText = "0001";
        }
    }

    function fetchData() {
        Papa.parse(SHEET_CSV, { download: true, header: true, complete: (res) => {
            allData = res.data;
            if(allData.length > 0) {
                document.getElementById('ui-school-name').innerText = allData[0]['Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'];
                document.getElementById('ui-manager-name').innerText = "Ø§Ù„Ù…Ø¯ÙŠØ±: " + allData[0]['Ø§Ù„Ù…Ø¯ÙŠØ±'];
                document.getElementById('ui-teacher-name').innerText = "Ø§Ù„Ù…Ø¹Ù„Ù…: " + allData[0]['Ø§Ù„Ù…Ø¹Ù„Ù…'];
                initVisitorCounter();
            }
        }});
    }

    function startApp() {
        const name = document.getElementById('stdName').value;
        const level = document.getElementById('stdLevel').value;
        if(!name || !level) return alert("Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ Ø¨Ø·Ù„!");
        
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('tabs-container').style.display = 'block';
        document.getElementById('welcome-msg').innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ: ${name}`;
        
        // ØªÙˆÙ„ÙŠØ¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
        let lookup = (level.includes("Ø³Ø§Ø¯Ø³")) ? "Ø³Ø§Ø¯Ø³" : level;
        const labs = [...new Set(allData.filter(q => q['Ø§Ù„ØµÙ'] === lookup).map(q => q['Ø§Ù„Ù…Ø®ØªØ¨Ø±']))];
        const div = document.getElementById('tabs'); div.innerHTML = "";
        labs.forEach(l => {
            div.innerHTML += `<button class="btn" style="background:rgba(255,255,255,0.1);" onclick="alert('Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ù…Ø®ØªØ¨Ø±: ${l}')">${l}</button>`;
        });
    }
</script>
</body>
</html>
